<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>An Introduction to boto’s DynamoDB v2 interface &mdash; boto v2.33.0</title>
    
    <link rel="stylesheet" href="_static/boto.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'HEAD',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="boto v2.33.0" href="index.html" />
    <link rel="next" title="Migrating from DynamoDB v1 to DynamoDB v2" href="migrations/dynamodb_v1_to_v2.html" />
    <link rel="prev" title="An Introduction to boto’s Support interface" href="support_tut.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="migrations/dynamodb_v1_to_v2.html" title="Migrating from DynamoDB v1 to DynamoDB v2"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="support_tut.html" title="An Introduction to boto’s Support interface"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">boto v2.33.0</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="an-introduction-to-boto-s-dynamodb-v2-interface">
<span id="dynamodb2-tut"></span><h1>An Introduction to boto&#8217;s DynamoDB v2 interface<a class="headerlink" href="#an-introduction-to-boto-s-dynamodb-v2-interface" title="Permalink to this headline">¶</a></h1>
<p>This tutorial focuses on the boto interface to AWS&#8217; <a class="reference external" href="http://aws.amazon.com/dynamodb/">DynamoDB</a> v2. This tutorial
assumes that you have boto already downloaded and installed.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This tutorial covers the <strong>SECOND</strong> major release of DynamoDB (including
local secondary index support). The documentation for the original
version of DynamoDB (&amp; boto&#8217;s support for it) is at
<a class="reference internal" href="dynamodb_tut.html"><em>DynamoDB v1</em></a>.</p>
</div>
<p>The v2 DynamoDB API has both a high-level &amp; low-level component. The low-level
API (contained primarily within <tt class="docutils literal"><span class="pre">boto.dynamodb2.layer1</span></tt>) provides an
interface that rough matches exactly what is provided by the API. It supports
all options available to the service.</p>
<p>The high-level API attempts to make interacting with the service more natural
from Python. It supports most of the featureset.</p>
<div class="section" id="the-high-level-api">
<h2>The High-Level API<a class="headerlink" href="#the-high-level-api" title="Permalink to this headline">¶</a></h2>
<p>Most of the interaction centers around a single object, the <tt class="docutils literal"><span class="pre">Table</span></tt>. Tables
act as a way to effectively namespace your records. If you&#8217;re familiar with
database tables from an RDBMS, tables will feel somewhat familiar.</p>
<div class="section" id="creating-a-new-table">
<h3>Creating a New Table<a class="headerlink" href="#creating-a-new-table" title="Permalink to this headline">¶</a></h3>
<p>To create a new table, you need to call <tt class="docutils literal"><span class="pre">Table.create</span></tt> &amp; specify (at a
minimum) both the table&#8217;s name as well as the key schema for the table.</p>
<p>Since both the key schema and local secondary indexes can not be
modified after the table is created, you&#8217;ll need to plan ahead of time how you
think the table will be used. Both the keys &amp; indexes are also used for
querying, so you&#8217;ll want to represent the data you&#8217;ll need when querying
there as well.</p>
<p>For the schema, you can either have a single <tt class="docutils literal"><span class="pre">HashKey</span></tt> or a combined
<tt class="docutils literal"><span class="pre">HashKey+RangeKey</span></tt>. The <tt class="docutils literal"><span class="pre">HashKey</span></tt> by itself should be thought of as a
unique identifier (for instance, like a username or UUID). It is typically
looked up as an exact value.
A <tt class="docutils literal"><span class="pre">HashKey+RangeKey</span></tt> combination is slightly different, in that the
<tt class="docutils literal"><span class="pre">HashKey</span></tt> acts like a namespace/prefix &amp; the <tt class="docutils literal"><span class="pre">RangeKey</span></tt> acts as a value
that can be referred to by a sorted range of values.</p>
<p>For the local secondary indexes, you can choose from an <tt class="docutils literal"><span class="pre">AllIndex</span></tt>, a
<tt class="docutils literal"><span class="pre">KeysOnlyIndex</span></tt> or a <tt class="docutils literal"><span class="pre">IncludeIndex</span></tt> field. Each builds an index of values
that can be queried on. The <tt class="docutils literal"><span class="pre">AllIndex</span></tt> duplicates all values onto the index
(to prevent additional reads to fetch the data). The <tt class="docutils literal"><span class="pre">KeysOnlyIndex</span></tt>
duplicates only the keys from the schema onto the index. The <tt class="docutils literal"><span class="pre">IncludeIndex</span></tt>
lets you specify a list of fieldnames to duplicate over.</p>
<p>Simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.fields</span> <span class="kn">import</span> <span class="n">HashKey</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>

<span class="go"># Uses your ``aws_access_key_id`` &amp; ``aws_secret_access_key`` from either a</span>
<span class="go"># config file or environment variable &amp; the default region.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>    <span class="n">HashKey</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">])</span>
</pre></div>
</div>
<p>A full example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">boto.dynamodb2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.fields</span> <span class="kn">import</span> <span class="n">HashKey</span><span class="p">,</span> <span class="n">RangeKey</span><span class="p">,</span> <span class="n">KeysOnlyIndex</span><span class="p">,</span> <span class="n">AllIndex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.types</span> <span class="kn">import</span> <span class="n">NUMBER</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>    <span class="n">HashKey</span><span class="p">(</span><span class="s">&#39;account_type&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">NUMBER</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">RangeKey</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">],</span> <span class="n">throughput</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>    <span class="s">&#39;read&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s">&#39;write&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
<span class="gp">... </span><span class="p">},</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>    <span class="n">AllIndex</span><span class="p">(</span><span class="s">&#39;EverythingIndex&#39;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="n">HashKey</span><span class="p">(</span><span class="s">&#39;account_type&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">NUMBER</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">])</span>
<span class="gp">... </span><span class="p">],</span>
<span class="gp">... </span><span class="c"># If you need to specify custom parameters like keys or region info...</span>
<span class="gp">... </span><span class="n">connection</span><span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">dynamodb2</span><span class="o">.</span><span class="n">connect_to_region</span><span class="p">(</span><span class="s">&#39;us-east-1&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="using-an-existing-table">
<h3>Using an Existing Table<a class="headerlink" href="#using-an-existing-table" title="Permalink to this headline">¶</a></h3>
<p>Once a table has been created, using it is relatively simple. You can either
specify just the <tt class="docutils literal"><span class="pre">table_name</span></tt> (allowing the object to lazily do an additional
call to get details about itself if needed) or provide the <tt class="docutils literal"><span class="pre">schema/indexes</span></tt>
again (same as what was used with <tt class="docutils literal"><span class="pre">Table.create</span></tt>) to avoid extra overhead.</p>
<p>Lazy example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Efficient example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.fields</span> <span class="kn">import</span> <span class="n">HashKey</span><span class="p">,</span> <span class="n">RangeKey</span><span class="p">,</span> <span class="n">AllIndex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.types</span> <span class="kn">import</span> <span class="n">NUMBER</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>    <span class="n">HashKey</span><span class="p">(</span><span class="s">&#39;account_type&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">NUMBER</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">RangeKey</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">],</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>    <span class="n">AllIndex</span><span class="p">(</span><span class="s">&#39;EverythingIndex&#39;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="n">HashKey</span><span class="p">(</span><span class="s">&#39;account_type&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">NUMBER</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">])</span>
<span class="gp">... </span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-new-item">
<h3>Creating a New Item<a class="headerlink" href="#creating-a-new-item" title="Permalink to this headline">¶</a></h3>
<p>Once you have a <tt class="docutils literal"><span class="pre">Table</span></tt> instance, you can add new items to the table. There
are two ways to do this.</p>
<p>The first is to use the <tt class="docutils literal"><span class="pre">Table.put_item</span></tt> method. Simply hand it a dictionary
of data &amp; it will create the item on the server side. This dictionary should
be relatively flat (as you can nest in other dictionaries) &amp; <strong>must</strong> contain
the keys used in the <tt class="docutils literal"><span class="pre">schema</span></tt>.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">)</span>

<span class="go"># Create the new user.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>    <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;johndoe&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s">&#39;first_name&#39;</span><span class="p">:</span> <span class="s">&#39;John&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s">&#39;last_name&#39;</span><span class="p">:</span> <span class="s">&#39;Doe&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">})</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The alternative is to manually construct an <tt class="docutils literal"><span class="pre">Item</span></tt> instance &amp; tell it to
<tt class="docutils literal"><span class="pre">save</span></tt> itself. This is useful if the object will be around for awhile &amp; you
don&#8217;t want to re-fetch it.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.items</span> <span class="kn">import</span> <span class="n">Item</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">)</span>

<span class="go"># WARNING - This doens&#39;t save it yet!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>    <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;johndoe&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s">&#39;first_name&#39;</span><span class="p">:</span> <span class="s">&#39;John&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s">&#39;last_name&#39;</span><span class="p">:</span> <span class="s">&#39;Doe&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">})</span>
<span class="go"># The data now gets persisted to the server.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-an-item-accessing-data">
<h3>Getting an Item &amp; Accessing Data<a class="headerlink" href="#getting-an-item-accessing-data" title="Permalink to this headline">¶</a></h3>
<p>With data now in DynamoDB, if you know the key of the item, you can fetch it
back out. Specify the key value(s) as kwargs to <tt class="docutils literal"><span class="pre">Table.get_item</span></tt>.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;johndoe&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Once you have an <tt class="docutils literal"><span class="pre">Item</span></tt> instance, it presents a dictionary-like interface to
the data.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;johndoe&#39;</span><span class="p">)</span>

<span class="go"># Read a field out.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span>
<span class="go">&#39;John&#39;</span>

<span class="go"># Change a field (DOESN&#39;T SAVE YET!).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Johann&#39;</span>

<span class="go"># Delete data from it (DOESN&#39;T SAVE YET!).</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;last_name&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-an-item">
<h3>Updating an Item<a class="headerlink" href="#updating-an-item" title="Permalink to this headline">¶</a></h3>
<p>Just creating new items or changing only the in-memory version of the <tt class="docutils literal"><span class="pre">Item</span></tt>
isn&#8217;t particularly effective. To persist the changes to DynamoDB, you have
three choices.</p>
<p>The first is sending all the data with the expectation nothing has changed
since you read the data. DynamoDB will verify the data is in the original state
and, if so, will send all of the item&#8217;s data. If that expectation fails, the
call will fail:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;johndoe&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Johann&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;whatever&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;man, that&#39;s just like your opinion&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;last_name&#39;</span><span class="p">]</span>

<span class="go"># Affects all fields, even the ones not changed locally.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The second is a full overwrite. If you can be confident your version of the
data is the most correct, you can force an overwrite of the data.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;johndoe&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Johann&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;whatever&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;man, that&#39;s just like your opinion&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;last_name&#39;</span><span class="p">]</span>

<span class="go"># Specify ``overwrite=True`` to fully replace the data.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The last is a partial update. If you&#8217;ve only modified certain fields, you
can send a partial update that only writes those fields, allowing other
(potentially changed) fields to go untouched.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;johndoe&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Johann&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;whatever&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;man, that&#39;s just like your opinion&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">johndoe</span><span class="p">[</span><span class="s">&#39;last_name&#39;</span><span class="p">]</span>

<span class="go"># Partial update, only sending/affecting the</span>
<span class="go"># ``first_name/whatever/last_name`` fields.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="o">.</span><span class="n">partial_save</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-an-item">
<h3>Deleting an Item<a class="headerlink" href="#deleting-an-item" title="Permalink to this headline">¶</a></h3>
<p>You can also delete items from the table. You have two choices, depending on
what data you have present.</p>
<p>If you already have an <tt class="docutils literal"><span class="pre">Item</span></tt> instance, the easiest approach is just to call
<tt class="docutils literal"><span class="pre">Item.delete</span></tt>.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">johndoe</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>If you don&#8217;t have an <tt class="docutils literal"><span class="pre">Item</span></tt> instance &amp; you don&#8217;t want to incur the
<tt class="docutils literal"><span class="pre">Table.get_item</span></tt> call to get it, you can call <tt class="docutils literal"><span class="pre">Table.delete_item</span></tt> method.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span><span class="o">.</span><span class="n">delete_item</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;johndoe&#39;</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="batch-writing">
<h3>Batch Writing<a class="headerlink" href="#batch-writing" title="Permalink to this headline">¶</a></h3>
<p>If you&#8217;re loading a lot of data at a time, making use of batch writing can
both speed up the process &amp; reduce the number of write requests made to the
service.</p>
<p>Batch writing involves wrapping the calls you want batched in a context manager.
The context manager imitates the <tt class="docutils literal"><span class="pre">Table.put_item</span></tt> &amp; <tt class="docutils literal"><span class="pre">Table.delete_item</span></tt>
APIs. Getting &amp; using the context manager looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">users</span><span class="o">.</span><span class="n">batch_write</span><span class="p">()</span> <span class="k">as</span> <span class="n">batch</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">batch</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;anotherdoe&#39;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s">&#39;first_name&#39;</span><span class="p">:</span> <span class="s">&#39;Another&#39;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s">&#39;last_name&#39;</span><span class="p">:</span> <span class="s">&#39;Doe&#39;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s">&#39;date_joined&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
<span class="gp">... </span>    <span class="p">})</span>
<span class="gp">... </span>    <span class="n">batch</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;alice&#39;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s">&#39;first_name&#39;</span><span class="p">:</span> <span class="s">&#39;Alice&#39;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s">&#39;date_joined&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
<span class="gp">... </span>    <span class="p">})</span>
<span class="gp">... </span>    <span class="n">batch</span><span class="o">.</span><span class="n">delete_item</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">jane</span><span class="s">&#39;)</span>
</pre></div>
</div>
<p>However, there are some limitations on what you can do within the context
manager.</p>
<ul class="simple">
<li>It can&#8217;t read data at all or do batch any other operations.</li>
<li>You can&#8217;t put &amp; delete the same data within a batch request.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Additionally, the context manager can only batch 25 items at a time for a
request (this is a DynamoDB limitation). It is handled for you so you can
keep writing additional items, but you should be aware that 100 <tt class="docutils literal"><span class="pre">put_item</span></tt>
calls is 4 batch requests, not 1.</p>
</div>
</div>
<div class="section" id="querying">
<h3>Querying<a class="headerlink" href="#querying" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <tt class="docutils literal"><span class="pre">Table</span></tt> object has both a <tt class="docutils literal"><span class="pre">query</span></tt> &amp; a <tt class="docutils literal"><span class="pre">query_2</span></tt> method. If you
are writing new code, <strong>DO NOT</strong> use <tt class="docutils literal"><span class="pre">Table.query</span></tt>. It presents results
in an incorrect order than expected &amp; is strictly present for
backward-compatibility.</p>
</div>
<p>Manually fetching out each item by itself isn&#8217;t tenable for large datasets.
To cope with fetching many records, you can either perform a standard query,
query via a local secondary index or scan the entire table.</p>
<p>A standard query typically gets run against a hash+range key combination.
Filter parameters are passed as kwargs &amp; use a <tt class="docutils literal"><span class="pre">__</span></tt> to separate the fieldname
from the operator being used to filter the value.</p>
<p>In terms of querying, our original schema is less than optimal. For the
following examples, we&#8217;ll be using the following table setup:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>    <span class="n">HashKey</span><span class="p">(</span><span class="s">&#39;account_type&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">RangeKey</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">],</span> <span class="n">indexes</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>    <span class="n">AllIndex</span><span class="p">(</span><span class="s">&#39;DateJoinedIndex&#39;</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="n">HashKey</span><span class="p">(</span><span class="s">&#39;account_type&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="n">RangeKey</span><span class="p">(</span><span class="s">&#39;date_joined&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">NUMBER</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">]),</span>
<span class="gp">... </span><span class="p">])</span>
</pre></div>
</div>
<p>When executing the query, you get an iterable back that contains your results.
These results may be spread over multiple requests as DynamoDB paginates them.
This is done transparently, but you should be aware it may take more than one
request.</p>
<p>To run a query for last names starting with the letter &#8220;D&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">names_with_d</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">query_2</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">account_type__eq</span><span class="o">=</span><span class="s">&#39;standard_user&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">last_name__beginswith</span><span class="o">=</span><span class="s">&#39;D&#39;</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">names_with_d</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span>
<span class="go">&#39;Bob&#39;</span>
<span class="go">&#39;Jane&#39;</span>
<span class="go">&#39;John&#39;</span>
</pre></div>
</div>
<p>You can also reverse results (<tt class="docutils literal"><span class="pre">reverse=True</span></tt>) as well as limiting them
(<tt class="docutils literal"><span class="pre">limit=2</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">rev_with_d</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">query_2</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">account_type__eq</span><span class="o">=</span><span class="s">&#39;standard_user&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">last_name__beginswith</span><span class="o">=</span><span class="s">&#39;D&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">limit</span><span class="o">=</span><span class="mi">2</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">rev_with_d</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span>
<span class="go">&#39;John&#39;</span>
<span class="go">&#39;Jane&#39;</span>
</pre></div>
</div>
<p>You can also run queries against the local secondary indexes. Simply provide
the index name (<tt class="docutils literal"><span class="pre">index='FirstNameIndex'</span></tt>) &amp; filter parameters against its
fields:</p>
<div class="highlight-python"><div class="highlight"><pre># Users within the last hour.
&gt;&gt;&gt; recent = users.query_2(
...     account_type__eq=&#39;standard_user&#39;,
...     date_joined__gte=time.time() - (60 * 60),
...     index=&#39;DateJoinedIndex&#39;
... )

&gt;&gt;&gt; for user in recent:
...     print user[&#39;first_name&#39;]
&#39;Alice&#39;
&#39;Jane&#39;
</pre></div>
</div>
<p>By default, DynamoDB can return a large amount of data per-request (up to 1Mb
of data). To prevent these requests from drowning other smaller gets, you can
specify a smaller page size via the <tt class="docutils literal"><span class="pre">max_page_size</span></tt> argument to
<tt class="docutils literal"><span class="pre">Table.query_2</span></tt> &amp; <tt class="docutils literal"><span class="pre">Table.scan</span></tt>. Doing so looks like:</p>
<div class="highlight-python"><div class="highlight"><pre># Small pages yield faster responses &amp; less potential of drowning other
# requests.
&gt;&gt;&gt; all_users = users.query_2(
...     account_type__eq=&#39;standard_user&#39;,
...     date_joined__gte=0,
...     max_page_size=10
... )

# Usage is the same, but now many smaller requests are done.
&gt;&gt;&gt; for user in recent:
...     print user[&#39;first_name&#39;]
&#39;Alice&#39;
&#39;Jane&#39;
</pre></div>
</div>
<p>Finally, if you need to query on data that&#8217;s not in either a key or in an
index, you can run a <tt class="docutils literal"><span class="pre">Table.scan</span></tt> across the whole table, which accepts a
similar but expanded set of filters. If you&#8217;re familiar with the Map/Reduce
concept, this is akin to what DynamoDB does.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Scans are consistent &amp; run over the entire table, so relatively speaking,
they&#8217;re more expensive than plain queries or queries against an LSI.</p>
</div>
<p>An example scan of all records in the table looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">all_users</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
</pre></div>
</div>
<p>Filtering a scan looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">owners_with_emails</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">is_owner__eq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">email__null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">recent</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span>
<span class="go">&#39;George&#39;</span>
<span class="go">&#39;John&#39;</span>
</pre></div>
</div>
<div class="section" id="the-resultset">
<h4>The <tt class="docutils literal"><span class="pre">ResultSet</span></tt><a class="headerlink" href="#the-resultset" title="Permalink to this headline">¶</a></h4>
<p>Both <tt class="docutils literal"><span class="pre">Table.query_2</span></tt> &amp; <tt class="docutils literal"><span class="pre">Table.scan</span></tt> return an object called <tt class="docutils literal"><span class="pre">ResultSet</span></tt>.
It&#8217;s a lazily-evaluated object that uses the <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#iterator-types">Iterator protocol</a>. It delays
your queries until you request the next item in the result set.</p>
<p>Typical use is simply a standard <tt class="docutils literal"><span class="pre">for</span></tt> to iterate over the results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result_set</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">result_set</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>However, this throws away results as it fetches more data. As a result, you
can&#8217;t index it like a <tt class="docutils literal"><span class="pre">list</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">result_set</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
<p>Because it does this, if you need to loop over your results more than once (or
do things like negative indexing, length checks, etc.), you should wrap it in
a call to <tt class="docutils literal"><span class="pre">list()</span></tt>. Ex.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result_set</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_users</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_set</span><span class="p">)</span>
<span class="go"># Slice it for every other user.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">all_users</span><span class="p">[::</span><span class="mi">2</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Wrapping calls like the above in <tt class="docutils literal"><span class="pre">list(...)</span></tt> <strong>WILL</strong> cause it to evaluate
the <strong>ENTIRE</strong> potentially large data set.</p>
<p>Appropriate use of the <tt class="docutils literal"><span class="pre">limit=...</span></tt> kwarg to <tt class="docutils literal"><span class="pre">Table.query_2</span></tt> &amp;
<tt class="docutils literal"><span class="pre">Table.scan</span></tt> calls are <strong>VERY</strong> important should you chose to do this.</p>
<p class="last">Alternatively, you can build your own list, using <tt class="docutils literal"><span class="pre">for</span></tt> on the
<tt class="docutils literal"><span class="pre">ResultSet</span></tt> to lazily build the list (&amp; potentially stop early).</p>
</div>
</div>
</div>
<div class="section" id="parallel-scan">
<h3>Parallel Scan<a class="headerlink" href="#parallel-scan" title="Permalink to this headline">¶</a></h3>
<p>DynamoDB also includes a feature called &#8220;Parallel Scan&#8221;, which allows you
to make use of <strong>extra</strong> read capacity to divide up your result set &amp; scan
an entire table faster.</p>
<p>This does require extra code on the user&#8217;s part &amp; you should ensure that
you need the speed boost, have enough data to justify it and have the extra
capacity to read it without impacting other queries/scans.</p>
<p>To run it, you should pick the <tt class="docutils literal"><span class="pre">total_segments</span></tt> to use, which is an integer
representing the number of temporary partitions you&#8217;d divide your table into.
You then need to spin up a thread/process for each one, giving each
thread/process a <tt class="docutils literal"><span class="pre">segment</span></tt>, which is a zero-based integer of the segment
you&#8217;d like to scan.</p>
<p>An example of using parallel scan to send out email to all users might look
something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">import</span> <span class="nn">boto.ses</span>
<span class="kn">import</span> <span class="nn">boto.dynamodb2</span>
<span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>


<span class="n">AWS_ACCESS_KEY_ID</span> <span class="o">=</span> <span class="s">&#39;&lt;YOUR_AWS_KEY_ID&gt;&#39;</span>
<span class="n">AWS_SECRET_ACCESS_KEY</span> <span class="o">=</span> <span class="s">&#39;&lt;YOUR_AWS_SECRET_KEY&gt;&#39;</span>
<span class="n">APPROVED_EMAIL</span> <span class="o">=</span> <span class="s">&#39;some@address.com&#39;</span>


<span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
    <span class="c"># Using Amazon&#39;s Simple Email Service, send an email to a given</span>
    <span class="c"># email address. You must already have an email you&#39;ve verified with</span>
    <span class="c"># AWS before this will work.</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">ses</span><span class="o">.</span><span class="n">connect_to_region</span><span class="p">(</span>
        <span class="s">&#39;us-east-1&#39;</span><span class="p">,</span>
        <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">AWS_ACCESS_KEY_ID</span><span class="p">,</span>
        <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">AWS_SECRET_ACCESS_KEY</span>
    <span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">send_email</span><span class="p">(</span>
        <span class="n">APPROVED_EMAIL</span><span class="p">,</span>
        <span class="s">&quot;[OurSite] New feature alert!&quot;</span><span class="p">,</span>
        <span class="s">&quot;We&#39;ve got some exciting news! We added a new feature to...&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="n">email</span><span class="p">]</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">process_segment</span><span class="p">(</span><span class="n">segment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_segments</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="c"># This method/function is executed in each thread, each getting its</span>
    <span class="c"># own segment to process through.</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">dynamodb2</span><span class="o">.</span><span class="n">connect_to_region</span><span class="p">(</span>
        <span class="s">&#39;us-east-1&#39;</span><span class="p">,</span>
        <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">AWS_ACCESS_KEY_ID</span><span class="p">,</span>
        <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">AWS_SECRET_ACCESS_KEY</span>
    <span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>

    <span class="c"># We pass in the segment &amp; total_segments to scan here.</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">segment</span><span class="o">=</span><span class="n">segment</span><span class="p">,</span> <span class="n">total_segments</span><span class="o">=</span><span class="n">total_segments</span><span class="p">):</span>
        <span class="n">send_email</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">send_all_emails</span><span class="p">():</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># We&#39;re choosing to divide the table in 3, then...</span>
    <span class="n">pool_size</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="c"># ...spinning up a thread for each segment.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pool_size</span><span class="p">):</span>
        <span class="n">worker</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">process_segment</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span>
                <span class="s">&#39;segment&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                <span class="s">&#39;total_segments&#39;</span><span class="p">:</span> <span class="n">pool_size</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span>
        <span class="c"># We start them to let them start scanning &amp; consuming their</span>
        <span class="c"># assigned segment.</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c"># Finally, we wait for each to finish.</span>
    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">send_all_emails</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="batch-reading">
<h3>Batch Reading<a class="headerlink" href="#batch-reading" title="Permalink to this headline">¶</a></h3>
<p>Similar to batch writing, batch reading can also help reduce the number of
API requests necessary to access a large number of items. The
<tt class="docutils literal"><span class="pre">Table.batch_get</span></tt> method takes a list (or any sliceable collection) of keys
&amp; fetches all of them, presented as an iterator interface.</p>
<p>This is done lazily, so if you never iterate over the results, no requests are
executed. Additionally, if you only iterate over part of the set, the minumum
number of calls are made to fetch those results (typically max 100 per
response).</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">boto.dynamodb2.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s">&#39;users&#39;</span><span class="p">)</span>

<span class="go"># No request yet.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">many_users</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">batch_get</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span>
<span class="go">    {&#39;username&#39;: &#39;alice&#39;},</span>
<span class="go">    {&#39;username&#39;: &#39;bob&#39;},</span>
<span class="go">    {&#39;username&#39;: &#39;fred&#39;},</span>
<span class="go">    {&#39;username&#39;: &#39;jane&#39;},</span>
<span class="go">    {&#39;username&#39;: &#39;johndoe&#39;},</span>
<span class="go">])</span>

<span class="go"># Now the request is performed, requesting all five in one request.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">many_users</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">user</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span>
<span class="go">&#39;Alice&#39;</span>
<span class="go">&#39;Bobby&#39;</span>
<span class="go">&#39;Fred&#39;</span>
<span class="go">&#39;Jane&#39;</span>
<span class="go">&#39;John&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-table">
<h3>Deleting a Table<a class="headerlink" href="#deleting-a-table" title="Permalink to this headline">¶</a></h3>
<p>Deleting a table is a simple exercise. When you no longer need a table, simply
run:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">users</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamodb-local">
<h3>DynamoDB Local<a class="headerlink" href="#dynamodb-local" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.html">Amazon DynamoDB Local</a> is a utility which can be used to mock DynamoDB
during development. Connecting to a running DynamoDB Local server is easy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">boto.dynamodb2.layer1</span> <span class="kn">import</span> <span class="n">DynamoDBConnection</span>


<span class="c"># Connect to DynamoDB Local</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">DynamoDBConnection</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span>
    <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="s">&#39;anything&#39;</span><span class="p">,</span>
    <span class="n">is_secure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># List all local tables</span>
<span class="n">tables</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">list_tables</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="next-steps">
<h3>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h3>
<p>You can find additional information about other calls &amp; parameter options
in the <a class="reference internal" href="ref/dynamodb2.html"><em>API docs</em></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">An Introduction to boto&#8217;s DynamoDB v2 interface</a><ul>
<li><a class="reference internal" href="#the-high-level-api">The High-Level API</a><ul>
<li><a class="reference internal" href="#creating-a-new-table">Creating a New Table</a></li>
<li><a class="reference internal" href="#using-an-existing-table">Using an Existing Table</a></li>
<li><a class="reference internal" href="#creating-a-new-item">Creating a New Item</a></li>
<li><a class="reference internal" href="#getting-an-item-accessing-data">Getting an Item &amp; Accessing Data</a></li>
<li><a class="reference internal" href="#updating-an-item">Updating an Item</a></li>
<li><a class="reference internal" href="#deleting-an-item">Deleting an Item</a></li>
<li><a class="reference internal" href="#batch-writing">Batch Writing</a></li>
<li><a class="reference internal" href="#querying">Querying</a><ul>
<li><a class="reference internal" href="#the-resultset">The <tt class="docutils literal"><span class="pre">ResultSet</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#parallel-scan">Parallel Scan</a></li>
<li><a class="reference internal" href="#batch-reading">Batch Reading</a></li>
<li><a class="reference internal" href="#deleting-a-table">Deleting a Table</a></li>
<li><a class="reference internal" href="#dynamodb-local">DynamoDB Local</a></li>
<li><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="support_tut.html"
                        title="previous chapter">An Introduction to boto&#8217;s Support interface</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="migrations/dynamodb_v1_to_v2.html"
                        title="next chapter">Migrating from DynamoDB v1 to DynamoDB v2</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/dynamodb2_tut.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><div><a href="boto.pdf">PDF Version</a></div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="migrations/dynamodb_v1_to_v2.html" title="Migrating from DynamoDB v1 to DynamoDB v2"
             >next</a> |</li>
        <li class="right" >
          <a href="support_tut.html" title="An Introduction to boto’s Support interface"
             >previous</a> |</li>
        <li><a href="index.html">boto v2.33.0</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009,2010, Mitch Garnaat.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>